# Experiment Agent

This project contains a Python-based AI agent (`agent.py`) designed to automate the process of generating, executing, refining, and summarizing scientific code experiments based on natural language prompts. It leverages the Anthropic Claude API (specifically `claude-3-5-sonnet-20240620`) to handle code generation, dependency analysis, and summarization tasks.

## Features

*   **Code Generation**: Generates Python code based on a user-provided experiment description.
*   **Dependency Management**: Analyzes generated code to identify necessary pip packages and installs them automatically.
*   **Code Execution**: Executes the generated Python code in an isolated environment, capturing stdout, stderr, and return codes.
*   **Iterative Refinement**: The agent attempts to refine the code based on past run summaries and any error context (up to `MAX_ITER` times).
*   **Result Summarization**: After successful execution, the agent analyzes the original prompt, the executed code, textual results (`results.txt`), and any generated images (`*.png`) to produce a Markdown summary of the experiment.
*   **Organized Output**: Each experiment run is stored in a timestamped subdirectory within the `runs` directory, containing the generated code (`main.py`), requirements (`requirements.txt`), results (`results.txt`), images (`*.png`), and a summary (`summary.md`).
*   **Logging**: Detailed logs of the agent's operations are recorded in `agent.log`.

## Prerequisites

*   Python 3.x
*   pip (Python package installer)
*   Anthropic API Key

## Configuration

1.  **API Key**: The agent requires an Anthropic API key. Set it as an environment variable:
    ```bash
    export ANTHROPIC_API_KEY='your_api_key_here'
    ```
2.  **Constants**: Key operational parameters are defined as constants at the top of `agent.py`:
    *   `MAX_ITER`: Maximum refinement attempts for code execution.
    *   `EXEC_TIMEOUT`: Maximum execution time for the generated Python script in seconds.
    *   `AGENT_RUN_DIR`: Parent directory for storing experiment runs.
    *   `LOG_FILENAME`: Name of the log file.
    *   `MODEL_NAME`: Anthropic model used.
    *   `MAX_TOKENS`: Maximum tokens for API responses.
    *   `TEMPERATURE`: Sampling temperature for API responses.

## Dependencies

The agent itself requires the `anthropic` library. Install it using:

```bash
pip install -r requirements.txt
```

Note that the agent will automatically install dependencies required by the *generated* code during its execution cycle.

## Usage

Run the agent script directly from the command line:

```bash
python agent.py
```

The script currently uses a hardcoded example prompt within the `if __name__ == "__main__":` block:

```python
initial_prompt = "Create a classification task with non-linear data and train a neural network on it as best you can."
```

To run with a different experiment prompt, modify this `initial_prompt` variable in the script before execution.

## Output

Each run creates a new directory inside `runs/`, named like `run_YYYYMMDD_HHMMSS`. This directory contains:

*   `main.py`: The (final) generated Python code for the experiment.
*   `requirements.txt`: The pip dependencies identified for `main.py`.
*   `results.txt`: Textual output saved by the `main.py` script (if any).
*   `*.png`: Image files (plots, figures) saved by `main.py` (if any).
*   `summary.md`: A Markdown file containing the summary generated by the agent for each successful attempt.

## Logging

Detailed information about the agent's execution, including API calls, code execution steps, errors, and summaries, is logged to `agent.log` in the project's root directory. 